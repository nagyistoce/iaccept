IMPORTANT : THIS TUTORIAL IS CURRENTLY UNDER CONSTRUCTION - DO NOT USE YET!!!

In this simple tutorial, we will build a new application to show you how to get started from scratch.  If you have experience with Objective-C and iOS development, you can skip directly to the FirstTest wiki page that will show you how to add acceptance tests to an existing project.

<h2> Our requirements </h2> 
We'll be building a very simple Hello World application. 

Let's say our application will have user stories :
 * US1: Say hello [just display Hello World! in a button at startup]
 * US2: Say goodby [when the button is clicked, display the Goodbye message]
 * US3: Hide the app [when is cliked while displaying Goodbye, quit the application]

In ATDD (Acceptance tests driven development), we want to first define the acceptance criteria of any functionality we are going to be building. The goal is to provide an unambiguous definition of the requirements to the development team so they know exactly what they need to do in the form of executable acceptance tests.

As a team, we've defined our iAccept acceptance test scenarios for these stories :

SC1 :  Say hello
 * Given I started the application
 * Then the Hello World! message is displayed

SC2 :  Say goodbye
 * Given I started the application
 * When I touch the message
 * Then the Goodbye message is displayed

SC3 :  Say i am back
 * Given the Goodbye message is displayed
 * When I touch the message
 * Then the I am back message is displayed


<h2> Let's setup our project environment... </h2> 

Before we start, you must have Xcode installed on your mac.  This tutorial is done with Xcode 4.3.

Here we go!

<h3>Step 1 : Creating the Helloworld project </h3>

Step 1.1 : <i>Open Xcode and click on "Create a new Xcode project".</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld1.png

Step 1.2 : <i>Select iOS Application -> Single View Application.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld2.png

Step 1.3 : <i>Click next and enter your Application details.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld3.png

Step 1.4 : <i>Choose the location of your project and click Create.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld4.png

Step 1.5 : We now have a new single view project.

http://iaccept.googlecode.com/svn/wiki/images/helloworld5.png

<h3>Step 2 : Creating a target to hold our acceptance tests </h3>
By putting the tests in a different target, we make it easier to isolate them so they wont be embedded in our application. We will be able to ship it without any dependency to the test framework.

Step 2.1 :<i> At the bottom of the screen, click on the Add Target button.  You must be in the project settings.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld6.png

You will then see the template screen.  Choose Empty Application.

http://iaccept.googlecode.com/svn/wiki/images/helloworld7.png

Step 2.2 : <i>Click next and enter the new target's details.  I like to use the name of my application prefixed with "at" standing for "acceptance tests". </i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld8.png

Step 2.3: <i>Click Finish.</i> We now have our test taget.  To be able to use iAccept, we must link the iAccept framework with our target.  Go in the atHelloWorld target settings, and click the summary tab.  Scroll down until you see the "Link Frameworks and Libraries" section.

http://iaccept.googlecode.com/svn/wiki/images/helloworld9.png

Step 2.4: <i>Click the + sign and the bottom of the section and thne click the Add Other... button.</i>  

http://iaccept.googlecode.com/svn/wiki/images/helloworld10.png

Step 2.5: <i>Navigate to the location of the iAccept framework you downloaded from the Downloads section of this site and select the unzipped framework.  Click Open.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld11.png

Step 2.6: <i>You can now see the iAccept framework in the list.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld12.png

Step 2.7: <i>iAccept has a dependency on the MapKit framework from the iOS sdk.  You must add this dependency by clicking the + button then add the MapKit framework under IOS 5.0.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld13.png

Step 2.8: <i>Your linked frameworks list should look like this:</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld14.png

Step 2.9 : To test HelloWorld application, we need to add its files in atHelloWorld target.  
Under "Compile Sources", you add the files ETAppDelegate.m and ETViewController.m. 
Under "Copy Bundle Resources" you add ETViewController.xib by clicking on the + button at the end of each section.  After doing so, it should look like this:

http://iaccept.googlecode.com/svn/wiki/images/helloworld17.png

Step 2.10: <i>Open the atHelloWorld target in the tree in the left pane of Xcode and delete the files ETAppDelegate.h and ETAppDelegate.m.  Sinc atHelloWorld is the test target, we dont need those files.</i>

http://iaccept.googlecode.com/svn/wiki/images/helloworld16.png

Step 2.11: To finish the setup, go in the main.m file of atHelloWorld target.

http://iaccept.googlecode.com/svn/wiki/images/helloworld15.png

Add the missing lines to your main.m file so it looks like this :

{{{
#import <UIKit/UIKit.h>
#import <Framework-iAccept/IARunner.h>
#import <Framework-iAccept/IADefaultRunnerExitHandler.h>
#import <Framework-iAccept/IAConfig.h>
#import "ETAppDelegate.h"

int main(int argc, char *argv[])
{
  @autoreleasepool {
        
    IARunner* runner = [[IARunner alloc]init];
    [runner addObserver:[[IADefaultRunnerExitHandler alloc] init]];
    [[IAConfig sharedInstance] setDelayBetweenTestsInSeconds:0.1];
    [[IAConfig sharedInstance] setDelayBetweenTestStatementsInSeconds:0.4];
        
    [runner runAfterDelay:1];
    return UIApplicationMain(argc, argv, nil, NSStringFromClass([ETAppDelegate class]));
  }
}
}}}

<h3>Step 3 : Writing the acceptance tests first !!! </h3>

We're all setup and our team has come with some test scenarios . How do we turn that into an executable specification?

Step 3.1: <i></i>

<h2> Writing the code for US1 : Say Hello </h2>

With iAccept, you write the executable specification in a test class.  Each test class contains the scenarios for a view.   By organizing the tests this way, it is easy and fast to find tests and to know where to put them.

We create a new class named <i>HelloWorldScenarios</i>.  To stay organized, we will create it in a group named scenarios.

To create the group, right click on atHelloWorld tree item in the left panel of Xcode and select <i>New Group</i>.  You can then rename it to <i>scenario</i>.

Right click on you scenario group and select <i>New File</i>.  Choose iOS -> Cocoa Touch -> Objective-C class

http://iaccept.googlecode.com/svn/wiki/images/helloworld19.png

Click <i>Next</i> and give you new class the name <i>HelloWorldScenarios</i>.

http://iaccept.googlecode.com/svn/wiki/images/helloworld20.png

Then, choose where you will save your new class, the default location is fine.  Be sure to use your <i>scenarios</i> group and to select only your atHelloWorld target.

http://iaccept.googlecode.com/svn/wiki/images/helloworld21.png

Click <i>Create</i>.

You can now see your new class files undre your <i>scenarios</i> group.  The file HelloWorldScenarios.h is the header file.  Since our class will not be used by another class directly, we wont add a definition for our scenarios in this file.  The only thing needed is to add the parent class from iAccept. All our scenarios are going to be in the file HelloWorldScenarios.h.

http://iaccept.googlecode.com/svn/wiki/images/helloworld22.png

Now we will write our first scenario.  We need to import the iAccept parent class for all scenario suite <i>IABaseScenarioSuite</i>.  The header file should look like this:

{{{
#import <Foundation/Foundation.h>
#import <Framework-iAccept/IABaseScenarioSuite.h>

@interface HelloWorldScenarios : IABaseScenarioSuite

@end
}}}

In our implementation file we will add a method beginning with the keyword <i>scenario</i>.  This keyword tells iAccept that the method is a scenario and it needs to execute it.

{{{
#import "HelloWorldScenarios.h"

@implementation HelloWorldScenarios

-(void)scenarioSayHello {
    IAGiven(i started the application);
    IAThen(the Hello World! message is displayed);
}

@end
}}}

The next thing needed is a fixture.  A fixture is where you write the code to do what the scenario step mandate.  For each iAccept project (target) you need a default fixture.  You identify a default fixture with a protocol named <i>IADefaultAppFixture</i>.

To stay organized, we create a group named <i>fixtures</i>.

In that group, we create a new Objective-C class named <i>HelloWorldFixture</i>. 

In the header file, we extend the class <i>IABaseFixture</i> has this parent will give us services and we add the protocol <i>IADefaultAppFixture</i> to identify it has our default fixture.

The code should look like this:

{{{
#import <Foundation/Foundation.h>
#import <Framework-iAccept/IABaseFixture.h>
#import <Framework-iAccept/IADefaultAppFixture.h>

@interface HelloWorldFixture : IABaseFixture<IADefaultAppFixture>

@end
}}}

Next step is to write the actual method that will implement our test.  Each scenario statement (IAGiven, IAWhen and IAThen) will call a method our fixture.  iAccept will concatenate the words of the statement with camel-casing, search of the method and then execute it.

For example, the statement {{{IAGiven(i started the application);}}} will try to call a method called {{{-(void)iStartedTheApplication}}}.


The final implementation of this method will look like this:

{{{
#import "HelloWorldFixture.h"
#import <Framework-iAccept/IAViewOperator.h>
#import <Framework-iAccept/IALabelOperator.h>

NSString * const STARTUP_MESSAGE = @"Hello World!";

@implementation HelloWorldFixture

- (void)resetMessage:(IALabelOperator *)messageLabel {
    NSString* messageText = [messageLabel text];
    
    if (![messageText isEqualToString:STARTUP_MESSAGE]) {
        [messageLabel setText:STARTUP_MESSAGE];
    }
}

-(void)iStartedTheApplication {
    IAViewOperator* helloWorldViewOperator = [IAViewOperator viewOperatorForAppDelegateRootView:[self appDelegate]];

    IALabelOperator* messageLabel = (IALabelOperator*)[helloWorldViewOperator searchForViewWithTag:1];
    
    [self resetMessage:messageLabel];
}

@end
}}}

The first line of method {{{-(void)iStartedTheApplication}}}, is creating a <i>IAViewOperator</i> with the root <i>UIView</i> of our application.

Operators are used to do things on views (buttons, tables, labels...).  All view operators have a search capability to search for subviews.  

In our example's second line, we use the <i>helloWorldViewOperator</i> to search for a subview identified by the tag 1.  In this scenario, we know that we have a one level hierarchy, so there is no possibility of conflict.  If we had a deeper hierarchy, we could have used the <i>toDepth:(int)depth</i> parameter. i.e. {{{[helloWorldViewOperator searchForViewWithTag:1 toDepth:1]}}}

Now that we have an handle on our future message label, we can reset its value so we begin the scenario with a known state.  This is what the method <i>resetMessage</i> does.

The second statement is verifying if the application starts with the message <i>Hello World!</i> in the message label.  Has with the IAGiven statement, we will create a method named <i>theHelloWorldMessageIsDisplayed<\i> derived from the sentence.

We will use the same operators has in the <i>iStartedTheApplication</i> method.  

Here is the new method :

{{{

}}}

<h2> Writing the code for US2 : Say Goodbye </h2>

<h2> Writing the code for US3 : Hide the app </h2>